# سیستم پایش موقعیت و شتاب خودرو بر بستر شبکه GPRS

این پروژه یک سیستم نهفته برای پایش بلادرنگ موقعیت، سرعت، شتاب و جهت‌گیری خودروها است که با استفاده از سخت‌افزارهای مقرون‌به‌صرفه و پروتکل MQTT بر بستر GPRS طراحی شده. این سیستم به ویژه برای شرایط شبکه‌ای ناپایدار ایران مناسب است و از چالش‌هایی مانند تأخیر متغیر و قطعی‌های مکرر پشتیبانی می‌کند.

## ویژگی‌ها
- **جمع‌آوری داده**: استفاده از سنسور MPU9250 برای داده‌های اینرسی (شتاب، جهت‌گیری، سرعت چرخش) و ماژول SIM808 برای GPS و GPRS.
- **پردازش داده**: الگوریتم‌های سبک مانند فیلتر Madgwick برای بهبود دقت جهت‌گیری و میانگین متحرک نمایی برای کاهش نویز شتاب. تخمین موقعیت تقریبی (Dead Reckoning) در غیاب GPS.
- **ارتباطات مقاوم**: انتقال داده با MQTT و تنظیم پویا نرخ ارسال (۳۰ ثانیه تا ۵ دقیقه) بر اساس شرایط شبکه. پشتیبان SMS برای داده‌های حیاتی در صورت قطعی.
- **نمایش داده**: داشبورد تعاملی Kibana برای نمایش بلادرنگ موقعیت، مسیر، سرعت و شتاب.
- **سازگاری**: مناسب برای خودروهای سواری تا صنعتی، با تمرکز روی شبکه‌های ضعیف GPRS.

## ساختار پروژه
پروژه به دو بخش اصلی تقسیم می‌شود: بخش edge-device که شامل کدهای دستگاه (با زیرفولدرهای build، libdeps، include، lib، src و test) است و بخش server که اجزای سرور مانند elasticsearch، kibana، mqtt-client، setup و tls را پوشش می‌دهد. همچنین فولدر doc برای مستندات مانند پرپوزال وجود دارد.

## پیش‌نیازها
- **سخت‌افزار**: Arduino Mega, MPU9250, SIM808, باتری لیتیومی ۳۰۰۰ میلی‌آمپرساعتی (اختیاری).
- **نرم‌افزار**: PlatformIO IDE (بر پایه Visual Studio Code), Python 3.x.x برای سرور, Docker برای ELK Stack.
- **کتابخانه‌ها**:
  - knolleary/PubSubClient@^2.8 (برای MQTT).
  - vshymanskyy/TinyGSM@^0.12.0 (برای GSM/GPRS).
  - hideakitai/MPU9250@^0.4.8 (برای سنسور MPU9250).
- **سایر**: حساب HiveMQ برای بروکر MQTT, Elasticsearch و Kibana.

## نصب و راه‌اندازی
1. **سخت‌افزار را مونتاژ کنید**:
   - MPU9250 را با I2C به پایه‌های A20 (SDA) و A21 (SCL) Arduino Mega وصل کنید.
   - SIM808 را با UART به پین‌های ۱۲ (RX) و ۱۳ (TX) متصل کنید و GND را مشترک کنید.
   - تغذیه را با آداپتور یا باتری تأمین کنید.

2. **کد را نصب کنید**:
   - ریپوزیتوری را کلون کنید: `git clone https://github.com/Baxayesh/Cps-Vehicle-Tracing-System`.
   - در PlatformIO، پروژه را باز کنید و کتابخانه‌ها را نصب کنید.
   - کد را کامپایل و آپلود کنید.

3. **سرور را راه‌اندازی کنید**:
   - Docker را نصب کنید و با Docker Compose، ELK Stack را اجرا کنید.
   - اسکریپت پایتون را برای Subscriber اجرا کنید و به تاپیک MQTT متصل کنید.

## استفاده
- سیستم را روشن کنید و داده‌ها را از سنسورها بخوانید.
- داده‌ها به‌طور خودکار پردازش و ارسال می‌شوند.
- در Kibana، داشبورد را باز کنید و وضعیت خودرو را مشاهده کنید (مثل موقعیت روی نقشه).

## لایسنس
MIT License – جزئیات در فایل LICENSE.

*این README با کمک هوش مصنوعی تولید شده است.*